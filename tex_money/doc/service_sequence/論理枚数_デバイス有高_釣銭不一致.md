# FIT-A  
## 閲覧情報  
VSCodeにて、拡張機能[Markdown Preview Enhanced]をインストールすると
シーケンスが確認できます。  
記述方法については、マークダウン マーメイドで検索すると出てきます。  

## TexMoney  
論理枚数(現在有高),デバイス有高,釣銭不一致に関する記述  


### 動作概要  
usecases texmy_safe_info_manager  
- deviceCashAvailable  
- logicalCashAvailable  

にて、論理有高,デバイス有高は管理される  

起動時  
- 論理枚数はDBに保存されている値としている  
- 下位サービスから通知されたデバイスの有高通知をデバイス有高値としている  

### 論理枚数算出  
#### (1)入金  
取引,補充処理実行時の入金通知から加算を行う  
※109:入金異常、103:入金完了、104:入金終了、302:回収データ通知、304:回収完了  
- 入金通知時,硬貨、紙幣のステータスが109-109,103-103,104-104時に更新される  
- 両替時,硬貨、紙幣のステータスが109-109,103-103時に更新される  
- 回収時,硬貨、紙幣のステータスが302-302,304-304時に更新される  

#### (2)出金  
上位から出金要求を受けた出金予定情報から減算を行う  

### デバイス有高  
有高通知を受信した場合に、更新を行う  
但し、更新するかどうかは以下条件に該当した場合（noticeAmountUpdateNg=false）となる  
- 入金通知で完了と判断した場合  
- 出金通知で完了と判断した場合  

### 釣銭不一致  
釣銭不一致は,有高更新後の入出金ステータス通知時にチェックされる  
不一致に関してのチェックは以下動作の際に実行される  
- 有高更新時に、デバイス有高と論理枚数を比較して不一致であった場合  
- 更新前のnotice_statusのエラーコードが"TXMYE100"釣銭不一致であった場合  

### 注意点  
- 入金時は入金完了通知後に更新される(後更新)  
- 出金時は出金要求タイミングで更新される(前更新)  
- デバイス有高は、入金又は出金が終わった後に更新される  
- 現状,釣銭可能枚数はデバイス有高がベースとなっている  

